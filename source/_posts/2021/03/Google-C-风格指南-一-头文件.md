---
title: Google C++风格指南(一)——头文件
date: 2021-03-24 17:53:57
tags: C++编码规范
categories:
- C++
---

# self-contained头文件

头文件需要自给自足，头文件本身应当是能编译的（个人理解时在没有源文件`.cxx`的情况也能编译通过）。

头文件应当用`#define`保护，并包含其所需要的所有其他头文件。

模板和内联函数的定义和声明应当处于同一文件内。

# define保护

所有头文件都应该使用`#define`防止文件被多重包含，并且为了保证唯一性，宏命名应当基于所在项目源码的全路径，格式应当为`<PROJECT>_<PATH>_<FILE>_H_`。

# 引入所有使用的头文件

不要依赖于`include`传递，如果`foo.cxx`文件使用了`bar.h`中的符号，就应当在`foo.cxx`中引入`bar.h`，即使在`bar.h`已经引入了。

也就是说，尽量在源文件中引入库，而不是在对应的头文件中引入，目的是为了减少引入依赖。例如当`A.cxx`依赖于`B.h`时，对`B.h`的任何修改都会导致`A.cxx`的重新构建，而此时`B.cxx`依赖于`C.h`，那么我们现在有两个选择，一是在`B.cxx`中引入`C.h`，二是在`B.h`中引入`C.h`。若选择第二种，我们对`C.h`的任何修改都会导致`A.cxx`的重新构建，若选择第一种，则不会触发`A.cxx`的重新构建。


# 前置声明 

前置声明是指类、函数和模板不带有定义的纯粹声明，应当避免使用前置声明，将声明放在头文件中，然后`#include`。

- 优点
  - 前置声明能够节省编译时间。
  - 前置声明能节省不必要的重新编译时间，使用`#include`会使得代码由于头文件中无关改动而被重新编译。
- 缺点
  - 前置声明隐藏依赖关系，头文件改动时，源文件会跳过必要的重新编译过程。
  - 前置声明可能被库的后续更改所破坏。
  - 前置声明来自`std::`中的符号时，行为未定义。
  - 前置声明甚至会改变代码含义。
  - 重构代码更为复杂和困难。

# 内联函数

- 经验：
  - 只有函数不多于10行时才将其定义为内联函数
  - 不要内联包含循环和`switch`的函数
  - 不要内联递归函数
  - 即使声明为内联函数，编译器也不一定会接受
  - 类声明内定义的函数默认为内联函数

# include的路径和顺序

避免使用`.`和`..`，按照项目源码路径完整`include`。

- 内联顺序：
  1. 同名头文件
  2. C系统文件
  3. C++系统文件
  4. 其他库`.h`
  5. 本项目`.h`

这种优先顺序保证了当`.h`文件遗漏某些库时，源文件的构建会立刻终止。

不同类型的头文件空格分隔。

例外情况，条件编译绝对是否引入库，如不同平台。


